{% extends "main.html" %}

{% load index %}

{% block content %}

{% if request.user == character.player or request.user == campaign.owner %}

<!-- Probably temporary styling -->
<style>
    .character-container 
    {
        display: grid;
        grid-template-columns: 1fr 1fr 2fr;
    }

    .big-stats-field 
    {
        width: 10%;
    }

    .stats-field 
    {
        width: 5%;
    }

    .skill-field 
    {
        width: 15%;
    }

    .attribute-box
    {
        width: 225px;
    }
</style>

<div class="character-container">
    {%csrf_token%}

    <!-- Base Information -->
    <div>
        <h1>{{ character.name }}</h1>
        <div>
            <label>Class </label>
            <input onkeyup="updateCharacter()" id="classe" type="text" value="{{character.classe}}"/>
        </div>
        <div>
            <label>Origin </label>
            <input onkeyup="updateCharacter()" id="origin" type="text" value="{{character.origin}}"/>
        </div>
        <br>


        <b>Attributes</b> <!--<small> <a href="#">Edit</a></small>-->
        <div class="attribute-box"> 
            <button onclick="rollAttribute('attribute_agility')">O</button>
            <input class="stats-field" onkeyup="updateCharacter()" id="attribute_agility" type="number" value="{{character.attribute_agility}}"/> 
            Agility
        </div>
        <br>
        <div class="attribute-box">
            <button onclick="rollAttribute('attribute_strength')">O</button>
            <input class="stats-field" onkeyup="updateCharacter()" id="attribute_strength" type="number" value="{{character.attribute_strength}}"/> 
            Strength
        </div>
        <br>
        <div class="attribute-box"> 
            <button onclick="rollAttribute('attribute_intellect')">O</button>
            <input class="stats-field" onkeyup="updateCharacter()" id="attribute_intellect" type="number" value="{{character.attribute_intellect}}"/> 
            Intellect
        </div>
        <br>
        <div class="attribute-box"> 
            <button onclick="rollAttribute('attribute_vigor')">O</button>
            <input class="stats-field" onkeyup="updateCharacter()" id="attribute_vigor" type="number" value="{{character.attribute_vigor}}"/> 
            Vigor
        </div>
        <br>
        <div class="attribute-box">
            <button onclick="rollAttribute('attribute_presence')">O</button>
            <input class="stats-field" onkeyup="updateCharacter()" id="attribute_presence" type="number" value="{{character.attribute_presence}}"/> 
            Presence
        </div>
        <br>


        <div>
            <label>EXP</label>
            <select onchange="updateCharacter()" id="paranormal_exposition">
                <option value="5" {% call_method character 'get_selected_exposition' 5 %}>5%</option>
                <option value="10" {% call_method character 'get_selected_exposition' 10 %}>10%</option>
                <option value="15" {% call_method character 'get_selected_exposition' 15 %}>15%</option>
                <option value="20" {% call_method character 'get_selected_exposition' 20 %}>20%</option>
                <option value="25" {% call_method character 'get_selected_exposition' 25 %}>25%</option>
                <option value="30" {% call_method character 'get_selected_exposition' 30 %}>30%</option>
                <option value="35" {% call_method character 'get_selected_exposition' 35 %}>35%</option>
                <option value="40" {% call_method character 'get_selected_exposition' 40 %}>40%</option>
                <option value="45" {% call_method character 'get_selected_exposition' 45 %}>45%</option>
                <option value="50" {% call_method character 'get_selected_exposition' 50 %}>50%</option>
                <option value="55" {% call_method character 'get_selected_exposition' 55 %}>55%</option>
                <option value="60" {% call_method character 'get_selected_exposition' 60 %}>60%</option>
                <option value="65" {% call_method character 'get_selected_exposition' 65 %}>65%</option>
                <option value="70" {% call_method character 'get_selected_exposition' 70 %}>70%</option>
                <option value="75" {% call_method character 'get_selected_exposition' 75 %}>75%</option>
                <option value="80" {% call_method character 'get_selected_exposition' 80 %}>80%</option>
                <option value="85" {% call_method character 'get_selected_exposition' 85 %}>85%</option>
                <option value="90" {% call_method character 'get_selected_exposition' 90 %}>90%</option>
                <option value="95" {% call_method character 'get_selected_exposition' 95 %}>95%</option>
                <option value="99" {% call_method character 'get_selected_exposition' 99 %}>99%</option>
            </select>
            //

            <label>PE / Turn</label>
            <input class="stats-field" onkeyup="updateCharacter()" id="pe_turn" type="number" value="{{character.pe_turn}}"/>
            //

            <label>Speed</label>
            <input class="stats-field" onkeyup="updateCharacter()" id="speed" type="number" value="{{character.speed}}"/>
        </div>
        <br>

        
        <div>
            <label>Health</label>
            <input class="big-stats-field" onkeyup="updateCharacter()" id="current_health" type="number" value="{{character.current_health}}"/>
            /
            <input class="big-stats-field" onkeyup="updateCharacter()" id="max_health" type="number" value="{{character.max_health}}"/>
        </div>
        <div>
            <label>Sanity</label>
            <input class="big-stats-field" onkeyup="updateCharacter()" id="current_sanity" type="number" value="{{character.current_sanity}}"/>
            /
            <input class="big-stats-field" onkeyup="updateCharacter()" id="max_sanity" type="number" value="{{character.max_sanity}}"/>
        </div>
        <div>
            <label>Effort</label>
            <input class="big-stats-field" onkeyup="updateCharacter()" id="current_effort" type="number" value="{{character.current_effort}}"/>
            /
            <input class="big-stats-field" onkeyup="updateCharacter()" id="max_effort" type="number" value="{{character.max_effort}}"/>
        </div>
        <br>

        
        <div>
            <b>Defense = <spam id="defense">A</spam> </b> <small> (10 + Equipment + Other) </small>
        </div>
        <div>
            <label>Equipment Defense</label>
            <input class="stats-field" onkeyup="updateCharacter()" id="equipment_defense" type="number" value="{{character.equipment_defense}}"/>
        </div>
        <div>
            <label>Other Defense</label>
            <input class="stats-field" onkeyup="updateCharacter()" id="other_defense" type="number" value="{{character.other_defense}}"/>
        </div>
        <br>


        <div>
            <label>Block</label>
            <input class="stats-field" onkeyup="updateCharacter()" id="block" type="number" value="{{character.block}}"/>
            //
            <label>Dodge</label>
            <input class="stats-field" onkeyup="updateCharacter()" id="dodge" type="number" value="{{character.dodge}}"/>
        </div>
        <br>


        <div>
            <label>Protection</label>
            <input onkeyup="updateCharacter()" id="protection" type="text" value="{{character.protection}}"/>
        </div>
        <div>
            <label>Resistance</label>
            <input onkeyup="updateCharacter()" id="resistance" type="text" value="{{character.resistance}}"/>
        </div>
        <div>
            <label>Proficiency</label>
            <input onkeyup="updateCharacter()" id="proficiency" type="text" value="{{character.proficiency}}"/>
        </div>
    </div>

    <!-- Skills -->
    <div>
        <h3>Skills</h3>

        {% for skill in skills_count %}

        <div>
            <button onclick="rollSkill('{% call_method character 'get_skill_name' skills skill %}')">O</button>
            <label style="font-size:14px">
                {% call_method character 'get_skill_formatted_name' skills skill %} 
            </label>
            <select onchange="updateCharacter()" id="{% call_method character 'get_skill_name' skills skill %}_attribute">
                <option value="0" {% call_method character 'get_selected_skill' 0 2 skills skill %} >AGI</option>
                <option value="1" {% call_method character 'get_selected_skill' 1 2 skills skill %} >INT</option>
                <option value="2" {% call_method character 'get_selected_skill' 2 2 skills skill %} >VIG</option>
                <option value="3" {% call_method character 'get_selected_skill' 3 2 skills skill %} >PRE</option>
                <option value="4" {% call_method character 'get_selected_skill' 4 2 skills skill %} >FOR</option>
            </select>
            <select onchange="updateCharacter()" id="{% call_method character 'get_skill_name' skills skill %}">
                <option value="0" {% call_method character 'get_selected_skill' 0 0 skills skill %} >0</option>
                <option value="1" {% call_method character 'get_selected_skill' 1 0 skills skill %} >5</option>
                <option value="2" {% call_method character 'get_selected_skill' 2 0 skills skill %} >10</option>
                <option value="3" {% call_method character 'get_selected_skill' 3 0 skills skill %} >15</option>
            </select>
            <input onkeyup="updateCharacter()" type="number" id="{% call_method character 'get_skill_name' skills skill %}_others" class="skill-field" type="text" value="{% call_method character 'get_skill_value' skills 1 skill %}"/>
        </div>

        {% endfor %}

    </div>

    <!-- Right Tab -->
    <div>
        <button class="tab-link" onclick="openPage('combat-tab', this)">Combat</button> 
        <button class="tab-link" onclick="openPage('abilities-tab', this)"> Abilities </button> 
        <button class="tab-link" onclick="openPage('rituals-tab', this)"> Rituals </button> 
        <button id="default-open" class="tab-link" onclick="openPage('inventory-tab', this)"> Inventory </button> 
        <button class="tab-link" onclick="openPage('description-tab', this)"> Description </button>

        <!-- Combat -->
        <div id="combat-tab" class="tab-content">
            <h3>
                Combat
            </h3>
        </div>
        <!-- Abilities -->
        <div id="abilities-tab" class="tab-content">
            
            <!-- New Ability Modal -->
            <dialog id="new-ability-modal">
                <h3> New Ability </h3>
                <p>
                    <label>*Name</label>
                    <input onkeyup="checkModalRequirements('ability', 'new')" id="new-ability-name" type="text"/>
                </p>
                <p>
                    <label>Description</label>
                    <textarea id="new-ability-description"></textarea>
                </p>
                <button id="new-ability-button" onclick="addNewAbility()"> Add ability </button>
                <button onclick="newAbilityModal.close()"> Cancel </button>
            </dialog>
            
            <!-- Update Ability Modal -->
            <dialog id="update-ability-modal">
                <h3> Edit Ability </h3>
                <input id="update-ability-id" type="hidden"/>
                <p>
                    <label>*Name</label>
                    <input onkeyup="checkModalRequirements('ability', 'update')" id="update-ability-name" type="text"/>
                </p>
                <p>
                    <label>Description</label>
                    <textarea id="update-ability-description"></textarea>
                </p>
                <button id="update-ability-button" onclick="updateAbility()"> Edit </button>
                <button onclick="updateAbilityModal.close()"> Cancel </button>
            </dialog>

            <h3> Abilities </h3>
            <button onclick="newAbilityModal.showModal(); checkModalRequirements('ability', 'new')"> New Ability </button>
            
            <br>
            <br>
            
            <hr>

            <div id="abilities-list">

            {% for ability in abilities %}
            
            <div>
                <b id="ability-{{ ability.id }}-name">{{ability.name}}</b>
                <p id="ability-{{ ability.id }}-description">{{ability.description}}</p>
                <button onclick="deleteAbility('{{ ability.id }}', this)">Delete</button>
                /
                <button onclick="openUpdateAbilityModal('{{ ability.id }}'); checkModalRequirements('ability', 'update')">Edit</button>
                <hr>
            </div>

            {% endfor %}

            </div>
        </div>
        <!-- Rituals -->
        <div id="rituals-tab" class="tab-content">
            <dialog id="new-ritual-modal">
                <h3> New Ritual </h3>
                <p>
                    <label>*Name</label>
                    <input onkeyup="checkModalRequirements('ritual', 'new')" id="new-ritual-name" type="text"/>
                </p>
                <select id="new-ritual-element">
                    <option value="0">Blood</option>
                    <option value="1">Death</option>
                    <option value="2">Knowledge</option>
                    <option value="3">Enery</option>
                    <option value="4">Fear</option>
                    <option value="5">Varies</option>
                </select>
                <select id="new-ritual-circle">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
                <p>
                    <label>Range</label>
                    <input id="new-ritual-range" type="text"/>
                </p>
                <p>
                    <label>Area</label>
                    <input id="new-ritual-area" type="text"/>
                </p>
                <p>
                    <label>Duration</label>
                    <input id="new-ritual-duration" type="text"/>
                </p>
                <p>
                    <label>Effect</label>
                    <input id="new-ritual-effect" type="text"/>
                </p>
                <p>
                    <label>Resistance</label>
                    <input id="new-ritual-resistance" type="text"/>
                </p>
                <p>
                    <label>Dices</label>
                    <input id="new-ritual-dices" type="text"/>
                </p>
                <p>
                    <label>Risen Dices</label>
                    <input id="new-ritual-risen-dices" type="text"/>
                </p>
                <p>
                    <label>True Dices</label>
                    <input id="new-ritual-true-dices" type="text"/>
                </p>
                <p>
                    <label>Description</label>
                    <textarea id="new-ritual-description"></textarea>
                </p>
                <button id="new-ritual-button" onclick="addNewRitual()"> Add ritual </button>
                <button onclick="newRitualModal.close()"> Cancel </button>
            </dialog>
            
            <dialog id="update-ritual-modal">
                <h3> Edit Ritual </h3>
                <input id="update-ritual-id" type="hidden"/>
                <p>
                    <label>*Name</label>
                    <input onkeyup="checkModalRequirements('ritual', 'update')" id="update-ritual-name" type="text"/>
                </p>
                <select id="update-ritual-element">
                    <option value="0">Blood</option>
                    <option value="1">Death</option>
                    <option value="2">Knowledge</option>
                    <option value="3">Energy</option>
                    <option value="4">Fear</option>
                    <option value="5">Varies</option>
                </select>
                <select id="update-ritual-circle">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
                <p>
                    <label>Range</label>
                    <input id="update-ritual-range" type="text"/>
                </p>
                <p>
                    <label>Area</label>
                    <input id="update-ritual-area" type="text"/>
                </p>
                <p>
                    <label>Duration</label>
                    <input id="update-ritual-duration" type="text"/>
                </p>
                <p>
                    <label>Effect</label>
                    <input id="update-ritual-effect" type="text"/>
                </p>
                <p>
                    <label>Resistance</label>
                    <input id="update-ritual-resistance" type="text"/>
                </p>
                <p>
                    <label>Dices</label>
                    <input id="update-ritual-dices" type="text"/>
                </p>
                <p>
                    <label>Risen Dices</label>
                    <input id="update-ritual-risen-dices" type="text"/>
                </p>
                <p>
                    <label>True Dices</label>
                    <input id="update-ritual-true-dices" type="text"/>
                </p>
                <p>
                    <label>Description</label>
                    <textarea id="update-ritual-description"></textarea>
                </p>
                <button id="update-ritual-button" onclick="updateRitual()"> Edit </button>
                <button onclick="updateRitualModal.close()"> Cancel </button>
            </dialog>

            <h3> Rituals </h3>
            <button onclick="newRitualModal.showModal(); checkModalRequirements('ritual', 'new')"> New Ritual </button>
            
            <br>
            <br>
            
            <hr>

            <div id="rituals-list">
                <!-- Rituals are added in javascript -->
            </div>
        </div>
        <!-- Inventory -->
        <div id="inventory-tab" class="tab-content">
            
            <!-- New Item Modals -->
            <div>
                <!--(0) General Item Modal-->
                <dialog id="new-general-item-modal">
                    <h3> New General Item </h3>
                    <p>
                        <label>*Name</label>
                        <input onkeyup="checkItemModalRequirements('general', 'new')" id="new-general-item-name" type="text"/>
                    </p>
                    <label>*Tag</label>
                    <select id="new-general-item-tag">
                        <option value="0">Acessory</option>
                        <option value="1">Explosives</option>
                        <option value="2">Operational Items</option>
                        <option value="3">Paranormal Items</option>
                    </select>
                    <p>
                        <label>*Category</label>
                        <select id="new-general-item-category">
                            <option value="0">0</option>
                            <option value="1">I</option>
                            <option value="2">II</option>
                            <option value="3">III</option>
                            <option value="4">IV</option>
                        </select>
                        /
                        <label>*Spaces</label>
                        <input onkeyup="checkItemModalRequirements('general', 'new')" id="new-general-item-spaces" type="number" value="0"/>
                    </p>
                    <p>
                        <label>Description</label>
                        <textarea id="new-general-item-description"></textarea>
                    </p>
                    <button id="new-general-item-button" onclick="addNewItem(0)"> Add item </button>
                    <button onclick="newGeneralItemModal.close()"> Cancel </button>
                </dialog>
                
                <!--(1) Weapon Item Modal-->
                <dialog id="new-weapon-item-modal">
                    <h3> New Weapon Item </h3>
                    <p>
                        <label>*Name</label>
                        <input onkeyup="checkWeaponModalRequirements('new')" id="new-weapon-item-name" type="text"/>
                    </p>
                    <p>
                        <label>Proficiency</label>
                        <input id="new-weapon-item-proficiency" type="text"/>
                        /
                        <label>Weapon Type</label>
                        <input id="new-weapon-item-type" type="text"/>
                        /
                        <label>Grip Type</label>
                        <input id="new-weapon-item-grip-type" type="text"/>
                    </p>
                    <p>
                        <label>*Damage</label>
                        <input onkeyup="checkWeaponModalRequirements('new')" id="new-weapon-item-damage" type="text"/>
                        /
                        <label>Secondary Damage</label>
                        <input id="new-weapon-item-secondary-damage" type="text"/>
                        /
                        <label>*Critical</label>
                        <input onkeyup="checkWeaponModalRequirements('new')" id="new-weapon-item-critical" type="number"/>
                        /
                        <label>*Multiplier</label>
                        <input onkeyup="checkWeaponModalRequirements('new')" id="new-weapon-item-multiplier" type="number"/>
                    </p>
                    <p>
                        <label>Damage Type</label>
                        <input id="new-weapon-item-damage-type" type="text"/>
                        /
                        <label>Range</label>
                        <input id="new-weapon-item-range" type="text"/>
                    </p>
                    <p>
                        <label>*Category</label>
                        <select id="new-weapon-item-category">
                            <option value="0">0</option>
                            <option value="1">I</option>
                            <option value="2">II</option>
                            <option value="3">III</option>
                            <option value="4">IV</option>
                        </select>
                        /
                        <label>*Spaces</label>
                        <input onkeyup="checkWeaponModalRequirements('new')" id="new-weapon-item-spaces" type="number"/>
                    </p>
                    <p>
                        <label>Description</label>
                        <textarea id="new-weapon-item-description"></textarea>
                    </p>
                    <button id="new-weapon-item-button" onclick="addNewItem(1)"> Add item </button>
                    <button onclick="newWeaponItemModal.close()"> Cancel </button>
                </dialog>

                <!--(2) Protection Item Modal-->
                <dialog id="new-protection-item-modal">
                    <h3> New Protection Item </h3>
                    <p>
                        <label>*Name</label>
                        <input onkeyup="checkProtectionModalRequirements('new')" id="new-protection-item-name" type="text"/>
                    </p>
                    <p>
                        <label>*Defense</label>
                        <input onkeyup="checkProtectionModalRequirements('new')" id="new-protection-item-defense" type="number"/>
                    </p>
                    <p>
                        <label>*Category</label>
                        <select id="new-protection-item-category">
                            <option value="0">0</option>
                            <option value="1">I</option>
                            <option value="2">II</option>
                            <option value="3">III</option>
                            <option value="4">IV</option>
                        </select>
                        /
                        <label>*Spaces</label>
                        <input onkeyup="checkProtectionModalRequirements('new')" id="new-protection-item-spaces" type="number"/>
                    </p>
                    <p>
                        <label>Description</label>
                        <textarea id="new-protection-item-description"></textarea>
                    </p>
                    <button id="new-protection-item-button" onclick="addNewItem(2)"> Add item </button>
                    <button onclick="newProtectionItemModal.close()"> Cancel </button>
                </dialog>

                <!--(3) Cursed Item Modal-->
                <dialog id="new-cursed-item-modal">
                    <h3> New Cursed Item </h3>
                    <p>
                        <label>*Name</label>
                        <input onkeyup="checkCursedModalRequirements('new')" id="new-cursed-item-name" type="text"/>
                    </p>
                    <label>*Element</label>
                    <select id="new-cursed-item-element">
                        <option value="0">Blood</option>
                        <option value="1">Death</option>
                        <option value="2">Knowledge</option>
                        <option value="3">Energy</option>
                        <option value="4">Fear</option>
                        <option value="5">Varies</option>
                    </select>
                    <p>
                        <label>*Category</label>
                        <select id="new-cursed-item-category">
                            <option value="0">0</option>
                            <option value="1">I</option>
                            <option value="2">II</option>
                            <option value="3">III</option>
                            <option value="4">IV</option>
                        </select>
                        /
                        <label>*Spaces</label>
                        <input onkeyup="checkCursedModalRequirements('new')" id="new-cursed-item-spaces" type="number"/>
                    </p>
                    <p>
                        <label>Description</label>
                        <textarea id="new-cursed-item-description"></textarea>
                    </p>
                    <button id="new-cursed-item-button" onclick="addNewItem(3)"> Add item </button>
                    <button onclick="newCursedItemModal.close()"> Cancel </button>
                </dialog>

                <!--(4) Ammunition Item Modal-->
                <dialog id="new-ammunition-item-modal">
                    <h3> New Ammunition Item </h3>
                    <p>
                        <label>*Name</label>
                        <input onkeyup="checkItemModalRequirements('ammunition', 'new')" id="new-ammunition-item-name" type="text"/>
                    </p>
                    <p>
                        <label>*Category</label>
                        <select id="new-ammunition-item-category">
                            <option value="0">0</option>
                            <option value="1">I</option>
                            <option value="2">II</option>
                            <option value="3">III</option>
                            <option value="4">IV</option>
                        </select>
                        /
                        <label>*Spaces</label>
                        <input onkeyup="checkItemModalRequirements('ammunition', 'new')" id="new-ammunition-item-spaces" type="number"/>
                    </p>
                    <p>
                        <label>Description</label>
                        <textarea onkeyup="checkItemModalRequirements('ammunition', 'new')" id="new-ammunition-item-description"></textarea>
                    </p>
                    <button id="new-ammunition-item-button" onclick="addNewItem(4)"> Add item </button>
                    <button onclick="newAmmunitionItemModal.close()"> Cancel </button>
                </dialog>
            </div>

            <!-- Update Item Modals -->
            <div>
                <!--(0) General Item Modal-->
                <dialog id="update-general-item-modal">
                    <input id="update-general-item-id" type="hidden"/>
                    <h3> Edit General Item </h3>
                    <p>
                        <label>*Name</label>
                        <input onkeyup="checkItemModalRequirements('general', 'update')" id="update-general-item-name" type="text"/>
                    </p>
                    <label>*Tag</label>
                    <select id="update-general-item-tag">
                        <option value="0">Acessory</option>
                        <option value="1">Explosives</option>
                        <option value="2">Operational Items</option>
                        <option value="3">Paranormal Items</option>
                    </select>
                    <p>
                        <label>*Category</label>
                        <select id="update-general-item-category">
                            <option value="0">0</option>
                            <option value="1">I</option>
                            <option value="2">II</option>
                            <option value="3">III</option>
                            <option value="4">IV</option>
                        </select>
                        /
                        <label>*Spaces</label>
                        <input onkeyup="checkItemModalRequirements('general', 'update')"  id="update-general-item-spaces" type="number"/>
                    </p>
                    <p>
                        <label>Description</label>
                        <textarea id="update-general-item-description"></textarea>
                    </p>
                    <button id="update-general-item-button" onclick="updateItem(0)"> Edit </button>
                    <button onclick="updateGeneralItemModal.close()"> Cancel </button>
                </dialog>
                
                <!--(1) Weapon Item Modal-->
                <dialog id="update-weapon-item-modal">
                    <input id="update-weapon-item-id" type="hidden"/>
                    <h3> Edit Weapon Item </h3>
                    <p>
                        <label>*Name</label>
                        <input onkeyup="checkWeaponModalRequirements('update')" id="update-weapon-item-name" type="text"/>
                    </p>
                    <p>
                        <label>Proficiency</label>
                        <input id="update-weapon-item-proficiency" type="text"/>
                        /
                        <label>Weapon Type</label>
                        <input id="update-weapon-item-type" type="text"/>
                        /
                        <label>Grip Type</label>
                        <input id="update-weapon-item-grip-type" type="text"/>
                    </p>
                    <p>
                        <label>*Damage</label>
                        <input onkeyup="checkWeaponModalRequirements('update')" id="update-weapon-item-damage" type="text"/>
                        /
                        <label>Secondary Damage</label>
                        <input id="update-weapon-item-secondary-damage" type="text"/>
                        /
                        <label>*Critical</label>
                        <input onkeyup="checkWeaponModalRequirements('update')" id="update-weapon-item-critical" type="text"/>
                        /
                        <label>*Multiplier</label>
                        <input onkeyup="checkWeaponModalRequirements('update')" id="update-weapon-item-multiplier" type="text"/>
                    </p>
                    <p>
                        <label>Damage Type</label>
                        <input id="update-weapon-item-damage-type" type="text"/>
                        /
                        <label>Range</label>
                        <input id="update-weapon-item-range" type="text"/>
                    </p>
                    <p>
                        <label>*Category</label>
                        <select id="update-weapon-item-category">
                            <option value="0">0</option>
                            <option value="1">I</option>
                            <option value="2">II</option>
                            <option value="3">III</option>
                            <option value="4">IV</option>
                        </select>
                        /
                        <label>*Spaces</label>
                        <input onkeyup="checkWeaponModalRequirements('update')" id="update-weapon-item-spaces" type="number"/>
                    </p>
                    <p>
                        <label>Description</label>
                        <textarea id="update-weapon-item-description"></textarea>
                    </p>
                    <button id="update-weapon-item-button" onclick="updateItem(1)"> Edit </button>
                    <button onclick="updateWeaponItemModal.close()"> Cancel </button>
                </dialog>

                <!--(2) Protection Item Modal-->
                <dialog id="update-protection-item-modal">
                    <input id="update-protection-item-id" type="hidden"/>
                    <h3> Edit Protection Item </h3>
                    <p>
                        <label>*Name</label>
                        <input onkeyup="checkProtectionModalRequirements('update')" id="update-protection-item-name" type="text"/>
                    </p>
                    <p>
                        <label>*Defense</label>
                        <input onkeyup="checkProtectionModalRequirements('update')" id="update-protection-item-defense" type="number"/>
                    </p>
                    <p>
                        <label>*Category</label>
                        <select id="update-protection-item-category">
                            <option value="0">0</option>
                            <option value="1">I</option>
                            <option value="2">II</option>
                            <option value="3">III</option>
                            <option value="4">IV</option>
                        </select>
                        /
                        <label>*Spaces</label>
                        <input onkeyup="checkProtectionModalRequirements('update')" id="update-protection-item-spaces" type="number"/>
                    </p>
                    <p>
                        <label>Description</label>
                        <textarea id="update-protection-item-description"></textarea>
                    </p>
                    <button id="update-protection-item-button" onclick="updateItem(2)"> Edit </button>
                    <button onclick="updateProtectionItemModal.close()"> Cancel </button>
                </dialog>

                <!--(3) Cursed Item Modal-->
                <dialog id="update-cursed-item-modal">
                    <input id="update-cursed-item-id" type="hidden"/>
                    <h3> Edit Cursed Item </h3>
                    <p>
                        <label>*Name</label>
                        <input onkeyup="checkCursedModalRequirements('update')" id="update-cursed-item-name" type="text"/>
                    </p>
                    <label>*Element</label>
                    <select id="update-cursed-item-element">
                        <option value="0">Blood</option>
                        <option value="1">Death</option>
                        <option value="2">Knowledge</option>
                        <option value="3">Energy</option>
                        <option value="4">Fear</option>
                        <option value="5">Varies</option>
                    </select>
                    <p>
                        <label>*Category</label>
                        <select id="update-cursed-item-category">
                            <option value="0">0</option>
                            <option value="1">I</option>
                            <option value="2">II</option>
                            <option value="3">III</option>
                            <option value="4">IV</option>
                        </select>
                        /
                        <label>*Spaces</label>
                        <input onkeyup="checkCursedModalRequirements('update')" id="update-cursed-item-spaces" type="number"/>
                    </p>
                    <p>
                        <label>Description</label>
                        <textarea id="update-cursed-item-description"></textarea>
                    </p>
                    <button id="update-cursed-item-button" onclick="updateItem(3)"> Edit </button>
                    <button onclick="updateCursedItemModal.close()"> Cancel </button>
                </dialog>

                <!--(4) Ammunition Item Modal-->
                <dialog id="update-ammunition-item-modal">
                    <input id="update-ammunition-item-id" type="hidden"/>
                    <h3> New Ammunition Item </h3>
                    <p>
                        <label>*Name</label>
                        <input onkeyup="checkItemModalRequirements('ammunition', 'update')" id="update-ammunition-item-name" type="text"/>
                    </p>
                    <p>
                        <label>*Category</label>
                        <select id="update-ammunition-item-category">
                            <option value="0">0</option>
                            <option value="1">I</option>
                            <option value="2">II</option>
                            <option value="3">III</option>
                            <option value="4">IV</option>
                        </select>
                        /
                        <label>*Spaces</label>
                        <input onkeyup="checkItemModalRequirements('ammunition', 'update')" id="update-ammunition-item-spaces" type="number"/>
                    </p>
                    <p>
                        <label>Description</label>
                        <textarea id="update-ammunition-item-description"></textarea>
                    </p>
                    <button id="update-ammunition-item-button" onclick="updateItem(4)"> Edit </button>
                    <button onclick="updateAmmunitionItemModal.close()"> Cancel </button>
                </dialog>
            </div>
        
            <h3> Inventory </h3>

            <!-- New items -->
            <div>
                <label> New Item: </label>
                <button onclick="checkWeaponModalRequirements('new'); newWeaponItemModal.showModal()"> Weapon </button>
                <button onclick="checkItemModalRequirements('ammunition', 'new'); newAmmunitionItemModal.showModal()"> Ammunition </button>
                <button onclick="checkItemModalRequirements('general', 'new'); newGeneralItemModal.showModal()"> General </button>
                <button onclick="checkProtectionModalRequirements('new'); newProtectionItemModal.showModal()"> Protection </button>
                <button onclick="checkCursedModalRequirements('new'); newCursedItemModal.showModal()"> Cursed Item </button>
            </div>

            <br>

            <!-- Main information -->
            <div>
                <div>
                    <label>Prestige Points</label>
                    <input class="stats-field" onkeyup="updateCharacter()" id="prestige" type="number" value="{{character.prestige}}"/>
                    /
                    <label>Patent</label>
                    <select onchange="updateCharacter()" id="patent">
                        <option value="0">Mundane</option>
                        <option value="1">Recruit</option>
                        <option value="2">Operator</option>
                        <option value="3">Special agent</option>
                        <option value="4">Operations oficial</option>
                    </select>
                </div>

                <br>

                <div>
                    <label>Item limit</label>
                    <input class="stats-field" onkeyup="updateCharacter()" id="category_limit_1" type="number" value="{{character.category_limit_1}}"/> 
                    <input class="stats-field" onkeyup="updateCharacter()" id="category_limit_2" type="number" value="{{character.category_limit_2}}"/> 
                    <input class="stats-field" onkeyup="updateCharacter()" id="category_limit_3" type="number" value="{{character.category_limit_3}}"/>  
                    <input class="stats-field" onkeyup="updateCharacter()" id="category_limit_4" type="number" value="{{character.category_limit_4}}"/>  
                </div>

                <div>
                    <label>On inventory</label>
                    <input disabled class="stats-field" id="category_items_1" type="number"/>
                    <input disabled class="stats-field" id="category_items_2" type="number"/>
                    <input disabled class="stats-field" id="category_items_3" type="number"/>
                    <input disabled class="stats-field" id="category_items_4" type="number"/> 
                </div>

                <br>

                <div>
                    <label>Credit limit</label>
                    <select onchange="updateCharacter()" id="credit_limit">
                        <option value="0">Low</option>
                        <option value="1">Average</option>
                        <option value="2">High</option>
                        <option value="3">Unlimited</option>
                    </select>
                    /
                    <label>Max weight</label>
                    <input class="stats-field" onkeyup="updateCharacter()" id="current_weight" type="number" value="{{character.current_weight}}"/> 
                    /
                    <input class="stats-field" onkeyup="updateCharacter()" id="max_weight" type="number" value="{{character.max_weight}}"/> 
                </div>
            </div>
            
            <hr>

            <!-- Item's List -->
            <div id="items-list">
                <!-- Items are added in javascript -->
            </div>

        </div>
        <!-- Description -->
        <div id="description-tab" class="tab-content">
            <h3>
                Description
            </h3>
            <p>
                <spam>Notes</spam><br>
                <textarea id="notes" onkeyup="updateCharacter()">{{character.notes}}</textarea>
            </p>
            <p>
                <spam>Appearance</spam><br>
                <textarea id="appearance" onkeyup="updateCharacter()">{{character.appearance}}</textarea>
            </p>
            <p>
                <spam>Personality</spam><br>
                <textarea id="personality" onkeyup="updateCharacter()">{{character.personality}}</textarea>
            </p>
            <p>
                <spam>Background</spam><br>
                <textarea id="background" onkeyup="updateCharacter()">{{character.background}}</textarea>
            </p>
            <p>
                <spam>Objective</spam><br>
                <textarea id="objective" onkeyup="updateCharacter()">{{character.objective}}</textarea>
            </p>
        </div>
    </div>
    
    <!-- Chat -->
    <div>
        {% if campaign != None %}

        {% include "base/chat.html" %}
    
        {% endif %}
    </div>
</div>

<script>

$(document).ready(updateCharacter());

//-----------------------------
// Page setup
//-----------------------------
function openPage(pageName, elmnt)
{
    // Hide all elements with class="tabcontent" by default */
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tab-content");
    for (i = 0; i < tabcontent.length; i++)
        tabcontent[i].style.display = "none";

    // Remove the background color of all tablinks/buttons
    tablinks = document.getElementsByClassName("tab-link");
    for (i = 0; i < tablinks.length; i++) 
        tablinks[i].style.backgroundColor = "";

    // Show the specific tab content
    document.getElementById(pageName).style.display = "block";
}

function updateModalHTML(modal, property, id, input)
{
    var updatedElement = document.getElementById('update-' + modal + '-' + property);
    
    try {
        var updatedContent = document.getElementById(modal + '-' + id + '-' + property).innerHTML;
    } catch {
        var updatedContent = "";
    }

    if (updatedContent == null)
        updatedContent = "";

    if (input == true)
    {
        updatedElement.value = updatedContent;
        return;
    }

    updatedElement.innerHTML = updatedContent;
}

function checkModalRequirements(property, modal)
{
    const button = document.getElementById(modal + '-' + property + '-button');

    if (document.getElementById(modal + '-' + property + '-name').value == "")
    {    
        button.disabled = true;
        return;
    }

    button.disabled = false;
}

document.getElementById("default-open").click();

//-----------------------------
// Ability tab
//-----------------------------
const newAbilityModal = document.getElementById('new-ability-modal');
const updateAbilityModal = document.getElementById('update-ability-modal');

function addNewAbility()
{
    //console.log("Adding new ability...");
    
    var abilityName = $('#new-ability-name').val();
    var abilityDescription = $('#new-ability-description').val();

    $.ajax({
        type:'POST',
        url:'{% url 'add-ability' %}',
        data:
        {
            character: {{ character.id }},
            name: abilityName,
            description: abilityDescription,
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            //console.log(data)
            if (data != -1)
            {
                const abilitiesList = document.getElementById('abilities-list');
                
                abilitiesElmnt.innerHTML += `
                <div>
                    <b id="ability-` + data + `-name"> ` + abilityName + `</b>
                    <p id="ability-` + data + `-name">` + abilityDescription + `</p>
                    <button onclick="deleteAbility('` + data + `', this)">
                        Delete
                    </button> 
                    / 
                    <button onclick="onkeyup="openUpdateAbilityModal('` + data + `'); checkModalRequirements('ability', 'update')"">
                        Edit
                    </button>
                    <hr>
                </div>`;
            }
        }
    });

    newAbilityModal.close();
}

function deleteAbility(ability, abilityElmnt)
{
    //console.log("Deleting ability...");
    
    $.ajax({
        type:'POST',
        url:'{% url 'delete-ability' %}',
        data:
        {
            character: {{ character.id }},
            ability: ability,
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            //console.log(data)
            if (data != -1)
                abilityElmnt.parentElement.remove();
        }
    });
}

function openUpdateAbilityModal(ability)
{
    updateAbilityModal.showModal();

    document.getElementById('update-ability-id').value = ability;
    updateModalHTML('ability', 'name', ability, true);
    updateModalHTML('ability', 'description', ability, false);
}

function updateAbility()
{
    //console.log("Deleting ability...");
    
    var id = $('#update-ability-id').val();

    const ability = {
        name: $('#update-ability-name').val(),
        description: $('#update-ability-description').val()
    }

    var data = {
        type:'POST',
        url:'{% url 'update-ability' %}',
        data:
        {
            character: {{ character.id }},
            ability: id,
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            //console.log(data)

            // Update on page html
            if (data != -1)
            {
                Object.entries(ability).forEach(([k,v]) => {
                    document.getElementById('ability-' + id + '-' + k).innerHTML = v;
                });
            }
        }
    };

    Object.entries(ability).forEach(([k,v]) => {
        data.data[k] = v;
    });

    $.ajax(data);

    updateAbilityModal.close();
}

//-----------------------------
// Rituals tab
//-----------------------------
const ritualsList = document.getElementById('rituals-list');
const newRitualModal = document.getElementById('new-ritual-modal');
const updateRitualModal = document.getElementById('update-ritual-modal');
    
var elements = ['Blood', 'Death', 'Knowledge', 'Energy', 'Fear', 'Varies']

function addNewRitual()
{
    //console.log("Adding new ritual...");

    var name = $('#new-ritual-name').val();

    var element = $('#new-ritual-element').val();
    var circle = $('#new-ritual-circle').val();

    var range = $('#new-ritual-range').val();
    var area = $('#new-ritual-area').val();
    var duration = $('#new-ritual-duration').val();
    var effect = $('#new-ritual-effect').val();
    var resistance = $('#new-ritual-resistance').val();

    var dices = $('#new-ritual-dices').val();
    var risenDices = $('#new-ritual-risen-dices').val();
    var trueDices = $('#new-ritual-true-dices').val();
    
    var description = $('#new-ritual-description').val();

    $.ajax({
        type:'POST',
        url:'{% url 'add-ritual' %}',
        data:
        {
            character: {{ character.id }},
            name: name,

            element: element,
            circle: circle,

            range: range,
            area: area,
            duration: duration,
            effect: effect,
            resistance: resistance,

            dices: dices,
            risen_dices: risenDices,
            true_dices: trueDices,

            description: description,
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            //console.log(data)
            if (data != -1)
            {
                html = ritualHTML(data, name, description, element, circle, range, area, duration, effect, resistance, dices, risenDices, trueDices);

                ritualsList.innerHTML += html;

                sortRituals();
            }
        }
    });

    newRitualModal.close();
}

function deleteRitual(ritual, ritualElmnt)
{
    //console.log("Deleting ritual...");
    
    $.ajax({
        type:'POST',
        url:'{% url 'delete-ritual' %}',
        data:
        {
            character: {{ character.id }},
            ritual: ritual,
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            //console.log(data)
            if (data != -1)
                ritualElmnt.parentElement.remove();
        }
    });
}

function openUpdateRitualModal(ritual)
{
    updateRitualModal.showModal();

    document.getElementById('update-ritual-id').value = ritual;
    updateModalHTML('ritual', 'name', ritual, true);

    document.getElementById('update-ritual-element').value = elements.indexOf(document.getElementById('ritual-' + ritual + '-element').innerHTML);
    updateModalHTML('ritual', 'circle', ritual, true);

    updateModalHTML('ritual', 'range', ritual, true);
    updateModalHTML('ritual', 'area', ritual, true);
    updateModalHTML('ritual', 'duration', ritual, true);
    updateModalHTML('ritual', 'effect', ritual, true);
    updateModalHTML('ritual', 'resistance', ritual, true);

    updateModalHTML('ritual', 'dices', ritual, true);
    updateModalHTML('ritual', 'risen-dices', ritual, true);
    updateModalHTML('ritual', 'true-dices', ritual, true);

    updateModalHTML('ritual', 'description', ritual, false);
}

function updateRitual()
{
    //console.log("Deleting ability...");
    
    var ritual = $('#update-ritual-id').val();

    var name = $('#update-ritual-name').val();

    var element = $('#update-ritual-element').val();
    var circle = $('#update-ritual-circle').val();

    var range = $('#update-ritual-range').val();
    var area = $('#update-ritual-area').val();
    var duration = $('#update-ritual-duration').val();
    var effect = $('#update-ritual-effect').val();
    var resistance = $('#update-ritual-resistance').val();

    var dices = $('#update-ritual-dices').val();
    var risenDices = $('#update-ritual-risen-dices').val();
    var trueDices = $('#update-ritual-true-dices').val();
    
    var description = $('#update-ritual-description').val();

    $.ajax({
        type:'POST',
        url:'{% url 'update-ritual' %}',
        data:
        {
            character: {{ character.id }},
            ritual: ritual,
            name: name,

            element: element,
            circle: circle,
            
            range: range,
            area: area,
            duration: duration,
            effect: effect,
            resistance: resistance,

            dices: dices,
            risen_dices: risenDices,
            true_dices: trueDices,

            description: description,
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            //console.log(data)

            // Update on page html
            if (data != -1)
            {
                // Remove previous not updated item
                document.getElementById('ritual-' + data + '-name').parentElement.remove();

                // Add new updated item
                ritualsList.innerHTML += ritualHTML(data, name, description, element, circle, range, area, duration, effect, resistance, dices, risenDices, trueDices);
            
                sortRituals();
            }
        }
    });

    updateRitualModal.close();
}


// Others
function sortRituals()
{
    const rituals = Array.from(ritualsList.querySelectorAll("#ritual"));

    const sortedRituals = rituals.sort((a, b) => {
        const aText = a.querySelector('b.ritual-name').textContent.trim();
        const bText = b.querySelector('b.ritual-name').textContent.trim();
    
        return aText > bText ? 1 : -1;
    });

    ritualsList.innerHTML = "";

    ritualsList.append(...sortedRituals);
}

//-----------------------------
// Inventory tab
//-----------------------------
const itemsList = document.getElementById('items-list');

const newGeneralItemModal = document.getElementById('new-general-item-modal');
const newWeaponItemModal = document.getElementById('new-weapon-item-modal');
const newProtectionItemModal = document.getElementById('new-protection-item-modal');
const newCursedItemModal = document.getElementById('new-cursed-item-modal');
const newAmmunitionItemModal = document.getElementById('new-ammunition-item-modal');

const updateGeneralItemModal = document.getElementById('update-general-item-modal');
const updateWeaponItemModal = document.getElementById('update-weapon-item-modal');
const updateProtectionItemModal = document.getElementById('update-protection-item-modal');
const updateCursedItemModal = document.getElementById('update-cursed-item-modal');
const updateAmmunitionItemModal = document.getElementById('update-ammunition-item-modal');


// Add items

function addNewItem(itemType)
{
    //console.log("Adding new ritual...");

    switch(itemType)
    {
        case 0:
            addGeneralItem();
            break;

        case 1:
            addWeaponItem();
            break;

        case 2:
            addProtectionItem();
            break;

        case 3:
            addCursedItem();
            break;

        case 4:
            addAmmunitionItem();
            break;
    }
}

function addGeneralItem()
{
    console.log("Adding general item...");
    
    var name = $('#new-general-item-name').val();    
    var category = $('#new-general-item-category').val();
    var spaces = $('#new-general-item-spaces').val();
    var description = $('#new-general-item-description').val();

    var tag = $('#new-general-item-tag').val();

    $.ajax({
        type:'POST',
        url:'{% url 'add-item' %}',
        data:
        {
            character: {{ character.id }},
            item_type: 0,
            
            name: name,
            category: category,
            spaces: spaces,
            description: description,

            tag: tag,

            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            console.log(data)
            if (data != -1)
            {
                // Add item to inventory
                itemsList.innerHTML += generalItemHTML(data, name, description, spaces, category, tag);

                if (category != 0)
                {
                    const categoryItem = document.getElementById("category_items_" + category);

                    categoryItem.value = parseInt(categoryItem.value) + 1;
                }

                // Sort inventory
                sortInventory();
            }
        }
    });

    newGeneralItemModal.close();
}

function addWeaponItem()
{
    console.log("Adding weapon item...");
    
    var name = $('#new-weapon-item-name').val();    
    var category = $('#new-weapon-item-category').val();
    var spaces = $('#new-weapon-item-spaces').val();
    var description = $('#new-weapon-item-description').val();

    var proficiency = $('#new-weapon-item-proficiency').val();
    var weaponType = $('#new-weapon-item-type').val();
    var gripType = $('#new-weapon-item-grip-type').val();

    var damage = $('#new-weapon-item-damage').val();
    var secondaryDamage = $('#new-weapon-item-secondary-damage').val();
    var critical = $('#new-weapon-item-critical').val();
    var multiplier = $('#new-weapon-item-multiplier').val();
    
    var damageType = $('#new-weapon-item-damage-type').val();
    var range = $('#new-weapon-item-range').val();

    $.ajax({
        type:'POST',
        url:'{% url 'add-item' %}',
        data:
        {
            character: {{ character.id }},
            item_type: 1,
            
            name: name,
            category: category,
            spaces: spaces,
            description: description,

            proficiency: proficiency,
            weapon_type: weaponType,
            grip_type: gripType,

            damage: damage,
            secondary_damage: secondaryDamage,
            critical: critical,
            multiplier: multiplier,

            damage_type: damageType,
            range: range,

            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            console.log(data)
            if (data != -1)
            {
                // Add item to inventory
                itemsList.innerHTML += weaponItemHTML(data, name, description, spaces, category, proficiency, weaponType, gripType, damage, secondaryDamage, critical, multiplier, damageType, range);

                if (category != 0)
                {
                    const categoryItem = document.getElementById("category_items_" + category);

                    categoryItem.value = parseInt(categoryItem.value) + 1;
                }

                // Sort inventory
                sortInventory();
            }
        }
    });

    newWeaponItemModal.close();
}

function addProtectionItem()
{
    console.log("Adding protection item...");
    
    var name = $('#new-protection-item-name').val();    
    var category = $('#new-protection-item-category').val();
    var spaces = $('#new-protection-item-spaces').val();
    var description = $('#new-protection-item-description').val();

    var defense = $('#new-protection-item-defense').val();

    $.ajax({
        type:'POST',
        url:'{% url 'add-item' %}',
        data:
        {
            character: {{ character.id }},
            item_type: 2,
            
            name: name,
            category: category,
            spaces: spaces,
            description: description,

            defense: defense,

            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            console.log(data)
            if (data != -1)
            {
                // Add item to inventory
                itemsList.innerHTML += protectionItemHTML(data, name, description, spaces, category, defense);

                if (category != 0)
                {
                    const categoryItem = document.getElementById("category_items_" + category);

                    categoryItem.value = parseInt(categoryItem.value) + 1;
                }

                // Sort inventory
                sortInventory();
            }
        }
    });

    newProtectionItemModal.close();
}

function addCursedItem()
{
    console.log("Adding cursed item...");
    
    var name = $('#new-cursed-item-name').val();    
    var category = $('#new-cursed-item-category').val();
    var spaces = $('#new-cursed-item-spaces').val();
    var description = $('#new-cursed-item-description').val();

    var element = $('#new-cursed-item-element').val();

    $.ajax({
        type:'POST',
        url:'{% url 'add-item' %}',
        data:
        {
            character: {{ character.id }},
            item_type: 3,
            
            name: name,
            category: category,
            spaces: spaces,
            description: description,

            element: element,

            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            console.log(data)
            if (data != -1)
            {
                // Add item to inventory
                itemsList.innerHTML += cursedItemHTML(data, name, description, spaces, category, element);

                if (category != 0)
                {
                    const categoryItem = document.getElementById("category_items_" + category);

                    categoryItem.value = parseInt(categoryItem.value) + 1;
                }

                // Sort inventory
                sortInventory();
            }
        }
    });

    newCursedItemModal.close();
}

function addAmmunitionItem()
{
    console.log("Adding ammunition item...");
    
    var name = $('#new-ammunition-item-name').val();    
    var category = $('#new-ammunition-item-category').val();
    var spaces = $('#new-ammunition-item-spaces').val();
    var description = $('#new-ammunition-item-description').val();

    var element = $('#new-ammunition-item-element').val();

    $.ajax({
        type:'POST',
        url:'{% url 'add-item' %}',
        data:
        {
            character: {{ character.id }},
            item_type: 0,
            
            name: name,
            category: category,
            spaces: spaces,
            description: description,

            tag: 4,

            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            console.log(data)
            if (data != -1)
            {
                // Add item to inventory
                itemsList.innerHTML += ammunitionItemHTML(data, name, description, spaces, category);

                if (category != 0)
                {
                    const categoryItem = document.getElementById("category_items_" + category);

                    categoryItem.value = parseInt(categoryItem.value) + 1;
                }

                // Sort inventory
                sortInventory();
            }
        }
    });

    newAmmunitionItemModal.close();
}

// Delete items
function deleteItem(itemType, item, itemElmnt)
{
    console.log("Deleting item...");
    
    $.ajax({
        type:'POST',
        url:'{% url 'delete-item' %}',
        data:
        {
            character: {{ character.id }},
            item_type: itemType,
            item: item,
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            //console.log(data)
            if (data != -1)
                itemElmnt.parentElement.remove();
        }
    });
}


// Open updated models
function openUpdateGeneralItemModal(item)
{
    updateGeneralItemModal.showModal();

    document.getElementById('update-general-item-id').value = item;
    updateModalHTML('general-item', 'name', item, true);
    updateModalHTML('general-item', 'category', item, true);
    updateModalHTML('general-item', 'spaces', item, true);
    updateModalHTML('general-item', 'tag', item, true);
    updateModalHTML('general-item', 'description', item, false);
}

function openUpdateWeaponItemModal(item)
{
    updateWeaponItemModal.showModal();

    document.getElementById('update-weapon-item-id').value = item;
    updateModalHTML('weapon-item', 'name', item, true);
    updateModalHTML('weapon-item', 'category', item, true);
    updateModalHTML('weapon-item', 'spaces', item, true);
    updateModalHTML('weapon-item', 'description', item, false);

    updateModalHTML('weapon-item', 'proficiency', item, true);
    updateModalHTML('weapon-item', 'type', item, true);
    updateModalHTML('weapon-item', 'grip-type', item, true);
    updateModalHTML('weapon-item', 'damage', item, true);
    updateModalHTML('weapon-item', 'secondary-damage', item, true);
    updateModalHTML('weapon-item', 'critical', item, true);
    updateModalHTML('weapon-item', 'multiplier', item, true);
    updateModalHTML('weapon-item', 'damage-type', item, true);
    updateModalHTML('weapon-item', 'range', item, true);
}

function openUpdateProtectionItemModal(item)
{
    updateProtectionItemModal.showModal();

    document.getElementById('update-protection-item-id').value = item;
    updateModalHTML('protection-item', 'name', item, true);
    updateModalHTML('protection-item', 'category', item, true);
    updateModalHTML('protection-item', 'spaces', item, true);
    updateModalHTML('protection-item', 'defense', item, true);
    updateModalHTML('protection-item', 'description', item, false);
}

function openUpdateCursedItemModal(item)
{
    updateCursedItemModal.showModal();

    document.getElementById('update-cursed-item-id').value = item;
    updateModalHTML('cursed-item', 'name', item, true);
    updateModalHTML('cursed-item', 'category', item, true);
    updateModalHTML('cursed-item', 'spaces', item, true);
    document.getElementById('update-cursed-item-element').value = elements.indexOf(document.getElementById('cursed-item-' + item + '-element').innerHTML);
    updateModalHTML('cursed-item', 'description', item, false);
}

function openUpdateCursedItemModal(item)
{
    updateCursedItemModal.showModal();

    document.getElementById('update-ammunition-item-id').value = item;
    updateModalHTML('ammunition-item', 'name', item, true);
    updateModalHTML('ammunition-item', 'category', item, true);
    updateModalHTML('ammunition-item', 'spaces', item, true);
    updateModalHTML('ammunition-item', 'description', item, false);
}

// Update items
function updateItem(itemType)
{
    switch(itemType)
    {
        case 0:
            updateGeneralItem();
            break;

        case 1:
            updateWeaponItem();
            break;

        case 2:
            updateProtectionItem();
            break;

        case 3:
            updateCursedItem();
            break;

        case 4:
            updateAmmunitionItem();
            break;
    }
}

function updateGeneralItem()
{    
    var id = $('#update-general-item-id').val();
    
    var name = $('#update-general-item-name').val();    
    var category = $('#update-general-item-category').val();
    var spaces = $('#update-general-item-spaces').val();
    var description = $('#update-general-item-description').val();

    var tag = $('#update-general-item-tag').val();

    $.ajax({
        type:'POST',
        url:'{% url 'update-item' %}',
        data:
        {
            character: {{ character.id }},
            item_type: 0,
            item: id,
            
            name: name,
            category: category,
            spaces: spaces,
            description: description,

            tag: tag,
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            console.log(data)

            // Update on page html
            if (data != -1)
            {
                document.getElementById('general-item-' + data + '-name').innerHTML = name;
                document.getElementById('general-item-' + data + '-category').innerHTML = category;
                document.getElementById('general-item-' + data + '-spaces').innerHTML = spaces;
                document.getElementById('general-item-' + data + '-description').innerHTML = description;

                document.getElementById('general-item-' + data + '-tag').innerHTML = tag;

                sortInventory();
            }
        }
    });

    updateGeneralItemModal.close();
}

function updateWeaponItem()
{
    var id = $('#update-weapon-item-id').val();

    var name = $('#update-weapon-item-name').val();    
    var category = $('#update-weapon-item-category').val();
    var spaces = $('#update-weapon-item-spaces').val();
    var description = $('#update-weapon-item-description').val();

    var proficiency = $('#update-weapon-item-proficiency').val();
    var weaponType = $('#update-weapon-item-type').val();
    var gripType = $('#update-weapon-item-grip-type').val();

    var damage = $('#update-weapon-item-damage').val();
    var secondaryDamage = $('#update-weapon-item-secondary-damage').val();
    var critical = $('#update-weapon-item-critical').val();
    var multiplier = $('#update-weapon-item-multiplier').val();
    
    var damageType = $('#update-weapon-item-damage-type').val();
    var range = $('#update-weapon-item-range').val();

    $.ajax({
        type:'POST',
        url:'{% url 'update-item' %}',
        data:
        {
            character: {{ character.id }},
            item_type: 1,
            item: id,
            
            name: name,
            category: category,
            spaces: spaces,
            description: description,

            proficiency: proficiency,
            weapon_type: weaponType,
            grip_type: gripType,

            damage: damage,
            secondary_damage: secondaryDamage,
            critical: critical,
            multiplier: multiplier,

            damage_type: damageType,
            range: range,
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            console.log(data)

            // Update on page html
            if (data != -1)
            {
                // Remove previous not updated item
                document.getElementById('weapon-item-' + id + '-name').parentElement.parentElement.remove();

                // Add item to inventory
                itemsList.innerHTML += weaponItemHTML(data, name, description, spaces, category, proficiency, weaponType, gripType, damage, secondaryDamage, critical, multiplier, damageType, range);
                
                sortInventory();
            }
        }
    });

    updateWeaponItemModal.close();
}

function updateProtectionItem()
{    
    var id = $('#update-protection-item-id').val();
    
    var name = $('#update-protection-item-name').val();    
    var category = $('#update-protection-item-category').val();
    var spaces = $('#update-protection-item-spaces').val();
    var description = $('#update-protection-item-description').val();

    var defense = $('#update-protection-item-defense').val();

    $.ajax({
        type:'POST',
        url:'{% url 'update-item' %}',
        data:
        {
            character: {{ character.id }},
            item_type: 2,
            item: id,
            
            name: name,
            category: category,
            spaces: spaces,
            description: description,

            defense: defense,
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            console.log(data)

            // Update on page html
            if (data != -1)
            {
                document.getElementById('protection-item-' + data + '-name').innerHTML = name;
                document.getElementById('protection-item-' + data + '-category').innerHTML = category;
                document.getElementById('protection-item-' + data + '-spaces').innerHTML = spaces;
                document.getElementById('protection-item-' + data + '-description').innerHTML = description;

                document.getElementById('protection-item-' + data + '-defense').innerHTML = defense;

                sortInventory();
            }
        }
    });

    updateProtectionItemModal.close();
}

function updateCursedItem()
{    
    var id = $('#update-cursed-item-id').val();
    
    var name = $('#update-cursed-item-name').val();    
    var category = $('#update-cursed-item-category').val();
    var spaces = $('#update-cursed-item-spaces').val();
    var description = $('#update-cursed-item-description').val();

    var element = $('#update-cursed-item-element').val();

    $.ajax({
        type:'POST',
        url:'{% url 'update-item' %}',
        data:
        {
            character: {{ character.id }},
            item_type: 3,
            item: id,
            
            name: name,
            category: category,
            spaces: spaces,
            description: description,

            element: element,
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            console.log(data)

            // Update on page html
            if (data != -1)
            {
                document.getElementById('cursed-item-' + data + '-name').innerHTML = name;
                document.getElementById('cursed-item-' + data + '-category').innerHTML = category;
                document.getElementById('cursed-item-' + data + '-spaces').innerHTML = spaces;
                document.getElementById('cursed-item-' + data + '-description').innerHTML = description;

                document.getElementById('cursed-item-' + data + '-element').innerHTML = elements[element];

                sortInventory();
            }
        }
    });

    updateCursedItemModal.close();
}

function updateAmmunitionItem()
{    
    var id = $('#update-ammunition-item-id').val();
    
    var name = $('#update-ammunition-item-name').val();    
    var category = $('#update-ammunition-item-category').val();
    var spaces = $('#update-ammunition-item-spaces').val();
    var description = $('#update-ammunition-item-description').val();

    var element = $('#update-ammunition-item-element').val();

    $.ajax({
        type:'POST',
        url:'{% url 'update-item' %}',
        data:
        {
            character: {{ character.id }},
            item_type: 4,
            item: id,
            
            name: name,
            category: category,
            spaces: spaces,
            description: description,

            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            console.log(data)

            // Update on page html
            if (data != -1)
            {
                document.getElementById('ammunition-item-' + data + '-name').innerHTML = name;
                document.getElementById('ammunition-item-' + data + '-category').innerHTML = category;
                document.getElementById('ammunition-item-' + data + '-spaces').innerHTML = spaces;
                document.getElementById('ammunition-item-' + data + '-description').innerHTML = description;

                document.getElementById('ammunition-item-' + data + '-element').innerHTML = elements[element];

                sortInventory();
            }
        }
    });

    updateAmmunitionItemModal.close();
}

// Others
function sortInventory()
{
    const items = Array.from(itemsList.querySelectorAll("#item"));

    const sortedItems = items.sort((a, b) => {
        const aText = a.querySelector('b.item-name').textContent.trim();
        const bText = b.querySelector('b.item-name').textContent.trim();
    
        return aText > bText ? 1 : -1;
    });

    itemsList.innerHTML = "";

    itemsList.append(...sortedItems);
}

// "checkModalRequirements" for both the general items and cursed items
function checkItemModalRequirements(property, modal)
{
    const button = document.getElementById(modal + '-' + property + '-item-button');

    if (document.getElementById(modal + '-' + property + '-item-name').value == "" ||
        document.getElementById(modal + '-' + property + '-item-spaces').value == "")
    {    
        button.disabled = true;
        return;
    }

    button.disabled = false;
}

function checkWeaponModalRequirements(modal)
{
    const button = document.getElementById(modal + '-weapon-item-button');

    if (document.getElementById(modal + '-weapon-item-name').value == "" ||
        document.getElementById(modal + '-weapon-item-spaces').value == "" ||
        document.getElementById(modal + '-weapon-item-damage').value == "" ||
        document.getElementById(modal + '-weapon-item-critical').value == "" ||
        document.getElementById(modal + '-weapon-item-multiplier').value == "")
    {    
        button.disabled = true;
        return;
    }

    button.disabled = false;
}

function checkProtectionModalRequirements(modal)
{
    const button = document.getElementById(modal + '-protection-item-button');

    if (document.getElementById(modal + '-protection-item-name').value == "" ||
        document.getElementById(modal + '-protection-item-spaces').value == "" ||
        document.getElementById(modal + '-protection-item-defense').value == "")
    {    
        button.disabled = true;
        return;
    }

    button.disabled = false;
}

function checkCursedModalRequirements(modal)
{
    const button = document.getElementById(modal + '-cursed-item-button');

    if (document.getElementById(modal + '-cursed-item-name').value == "" ||
        document.getElementById(modal + '-cursed-item-spaces').value == "" ||
        document.getElementById(modal + '-cursed-item-element').value == "")
    {    
        button.disabled = true;
        return;
    }

    button.disabled = false;
}

//-----------------------------
// HTML Generator
//-----------------------------

function ritualHTML(id, name, description, element, circle, range, area, duration, effect, resistance, dices, risenDices, trueDices)
{
    // Header of the ritual                
    var html = `
    <div id="ritual">
        <b id="ritual-` + id + `-name" class="ritual-name">` + name + `</b>

        <br>

        <p>
            <spam id="ritual-` + id + `-element">` + elements[element] + `</spam> 
            /
            <spam id="ritual-` + id + `-circle">` + circle + `</spam>
        </p>
        
        <div>`;

    // Optional elements that the ritual may or may not have

    if (range != "")
        html += `
        <div>
            <label> Range: </label>
            <spam id="ritual-` + id + `-range">` + range + `</spam>
        </div>`;
    
    if (area != "")
        html += `
        <div>
            <label> Area: </label>
            <spam id="ritual-` + id + `-area">` + area + `</spam>
        </div>`;
    
    if (duration != "")
        html += `
        <div>
            <label> Duration: </label>
            <spam id="ritual-` + id + `-duration">` + duration + `</spam>
        </div>`;

    if (effect != "")
        html += `
        <div>
            <label> Effect: </label>
            <spam id="ritual-` + id + `-effect">` + effect + `</spam>
        </div>`;
        
    if (resistance != "")
        html += `
        <div>
            <label> Resistance: </label>
            <spam id="ritual-` + id + `-resistance">` + resistance + `</spam>
        </div>`;
    
    html.innerHTML += `<div>`;
        
    if (dices != "")
        html += `
        <label> Dices: </label>
        <b>
            <spam id="ritual-` + id + `-dices">` + dices + `</spam> 
        </b>
        / `;
        
    if (risenDices != "")
        html += `
        <label> Risen Dices: </label>
        <b>
            <spam id="ritual-` + id + `-risen-dices">` + risenDices + `</spam>
        </b>
        /`;
        
    if (trueDices != "")
        html += `
        <label> True Dices: </label>
        <b>
            <spam id="ritual-` + id + `-true-dices">` + trueDices + `</spam>
        </b>`;
        

    // Footer of the ritual
    html += `</div>
        
        <p id="ritual-` + id + `-description">` + description + `</p>

        <button onclick="deleteRitual(` + id + `, this)">Delete</button>
        /
        <button onclick="openUpdateRitualModal('` + id + `')">Edit</button>
        <hr>
    </div>`;

    return html;
}

function generalItemHTML(id, name, description, spaces, category, tag)
{
    return `
        <div id="item">
            <p>
                <b id="general-item-` + id + `-name" class="item-name">` + name + `</b>
            </p>

            <small id="general-item-` + id + `-tag">` + tag + `</small>

            <div>
                <label> Category: </label>
                <spam id="general-item-` + id + `-category">` + category + `</spam>
                /
                <label> Spaces: </label>
                <spam id="general-item-` + id + `-spaces">` + spaces + `</spam>
            </div>

            <p id="general-item-` + id + `-description">` + description + `</p>

            <button onclick="deleteItem(0, '` + id + `', this)">Delete</button>
            /
            <button onclick="openUpdateGeneralItemModal('` + id + `'); checkItemModalRequirements('general', 'update')">Edit</button>
            <hr>
        </div>`;
}

function weaponItemHTML(id, name, description, spaces, category, proficiency, type, gripType, damage, secondaryDamage, critical, multiplier, damageType, range)
{
    var html = `
    <div id="item">
        <div>
            <b id="weapon-item-` + id + `-name" class="item-name">` + name + `</b>
        </div>`;

    if (proficiency != "")
        html += `
        <div>
            <label>Proficiency: </label>
            <spam id="weapon-item-` + id + `-proficiency">` + proficiency + `</spam>
        </div>`;

    if (type != "")
        html += `
        <div>
            <label>Weapon Type: </label>
            <spam id="weapon-item-` + id + `-type">` + type + `</spam>
        </div>`;

    if (gripType != "")
        html += `
        <div>
            <label>Grip Type: </label>
            <spam id="weapon-item-` + id + `-grip-type">` + gripType + `</spam>
        </div>`;
    
    html += `
        <br>
        <div>
            <spam id="weapon-item-` + id + `-damage">` + damage + `</spam>
        `;

    if (secondaryDamage != "")
        html += `
        / <spam id="weapon-item-` + id + `-secondary-damage">` + secondaryDamage + `</spam>
        `;
        
    if (damageType != "")
        html += `
        <div>
            <label>Type: </label>
            <spam id="weapon-item-` + id + `-damage-type">` + damageType + `</spam>
        </div>`;

    if (range != "")
        html += `
        <div>
            <label>Range: </label>
            <spam id="weapon-item-` + id + `-range">` + range + `</spam>
        </div>`;

    html += `
            <spam id="weapon-item-` + id + `-critical">` + critical + `</spam>
            (<spam id="weapon-item-` + id + `-multiplier">` + multiplier + `</spam>)
        </div>`;

    html += `
        <div>
            <label> Category: </label>
            <spam id="weapon-item-` + id + `-category">` + category + `</spam>
            /
            <label> Spaces: </label>
            <spam id="weapon-item-` + id + `-spaces">` + spaces + `</spam>
        </div>

        <p id="weapon-item-` + id + `-description">` + description + `</p>

        <button onclick="deleteItem(1, '` + id + `', this)">Delete</button>
        /
        <button onclick="openUpdateWeaponItemModal('` + id + `'); checkWeaponModalRequirements('update')">Edit</button>
        <hr>
    </div>`;

    return html;
}

function protectionItemHTML(id, name, description, spaces, category, defense)
{
    return `
        <div id="item">
            <p>
                <b id="protection-item-` + id + `-name" class="item-name">` + name + `</b>
            </p>

            <div>
                <label>Defense: </label>
                <spam id="protection-item-` + id + `-defense">` + defense + `</spam>
            </div>

            <div>
                <label> Category: </label>
                <spam id="protection-item-` + id + `-category">` + category + `</spam>
                /
                <label> Spaces: </label>
                <spam id="protection-item-` + id + `-spaces">` + spaces + `</spam>
            </div>

            <p id="protection-item-` + id + `-description">` + description + `</p>

            <button onclick="deleteItem(2, '` + id + `', this)">Delete</button>
            /
            <button onclick="openUpdateProtectionItemModal('` + id + `'); checkProtectionModalRequirements('update')">Edit</button>
            <hr>
        </div>`;
}

function cursedItemHTML(id, name, description, spaces, category, element)
{
    return `
        <div id="item">
            <p>
                <b id="cursed-item-` + id + `-name" class="item-name">` + name + `</b>
            </p>

            <div>
                <label>Element: </label>
                <spam id="cursed-item-` + id + `-element">` + elements[element] + `</spam>
            </div>

            <div>
                <label> Category: </label>
                <spam id="cursed-item-` + id + `-category">` + category + `</spam>
                /
                <label> Spaces: </label>
                <spam id="cursed-item-` + id + `-spaces">` + spaces + `</spam>
            </div>

            <p id="cursed-item-` + id + `-description">` + description + `</p>

            <button onclick="deleteItem(3, '` + id + `', this)">Delete</button>
            /
            <button onclick="openUpdateCursedItemModal('` + id + `'); checkCursedModalRequirements('update')">Edit</button>
            <hr>
        </div>`;
}

function ammunitionItemHTML(id, name, description, spaces, category)
{
    return `
        <div id="item">
            <p>
                <b id="ammunition-item-` + id + `-name" class="item-name">` + name + `</b>
            </p>

            <div>
                <label> Category: </label>
                <spam id="ammunition-item-` + id + `-category">` + category + `</spam>
                /
                <label> Spaces: </label>
                <spam id="ammunition-item-` + id + `-spaces">` + spaces + `</spam>
            </div>

            <p id="ammunition-item-` + id + `-description">` + description + `</p>

            <button onclick="deleteItem(0, '` + id + `', this)">Delete</button>
            /
            <button onclick="openUpdateAmmunitionItemModal('` + id + `'); checkItemModalRequirements('ammunition', 'update')">Edit</button>
            <hr>
        </div>`;
}

function generateDataObjects()
{   
    // Rituals
    {% for ritual in rituals %}

    ritualsList.innerHTML += ritualHTML(
        {{ ritual.id }}, 
        "{{ ritual.name }}", 
        "{{ ritual.description }}", 
        {{ ritual.element }}, 
        {{ ritual.circle }}, 
        "{{ ritual.range }}", 
        "{{ ritual.area }}", 
        "{{ ritual.duration }}", 
        "{{ ritual.effect }}", 
        "{{ ritual.resistance }}", 
        "{{ ritual.dices }}", 
        "{{ ritual.risen_dices }}", 
        "{{ ritual.true_dices }}"
    );

    {% endfor %}

    var categoryItems = new Array(0, 0, 0, 0, 0);

    // General Items
    {% for item in general_items %}
    
    {% if item.tag != 4 %}

    itemsList.innerHTML += generalItemHTML(
        {{ item.id }},
        "{{ item.name }}",
        "{{ item.description }}",
        {{ item.spaces }},
        {{ item.category }},
        {{ item.tag }}
    );

    {% else %}

    itemsList.innerHTML += ammunitionItemHTML(
        {{ item.id }},
        "{{ item.name }}",
        "{{ item.description }}",
        {{ item.spaces }},
        {{ item.category }}
    );

    {% endif %}

    categoryItems[{{ item.category }}] += 1;

    {% endfor %}

    // Weapon Items
    {% for item in weapon_items %}
    
    itemsList.innerHTML += weaponItemHTML(
        {{ item.id }},
        "{{ item.name }}",
        "{{ item.description }}",
        {{ item.spaces }},
        {{ item.category }},
        "{{ item.proficiency }}",
        "{{ item.weapon_type }}",
        "{{ item.grip_type }}",
        "{{ item.damage }}",
        "{{ item.secondary_damage }}",
        {{ item.critical }},
        {{ item.multiplier }},
        "{{ damageType }}",
        "{{ range }}"
    )

    categoryItems[{{ item.category }}] += 1;

    {% endfor %}

    // Protection Items
    {% for item in protection_items %}
    
    itemsList.innerHTML += protectionItemHTML(
        {{ item.id }},
        "{{ item.name }}",
        "{{ item.description }}",
        {{ item.spaces }},
        {{ item.category }},
        {{ item.defense }}
    );

    categoryItems[{{ item.category }}] += 1;

    {% endfor %}

    // Cursed Items
    {% for item in cursed_items %}
    
    itemsList.innerHTML += cursedItemHTML(
        {{ item.id }},
        "{{ item.name }}",
        "{{ item.description }}",
        {{ item.spaces }},
        {{ item.category }},
        {{ item.element }}
    );

    categoryItems[{{ item.category }}] += 1;

    {% endfor %}


    // Total category value of the items on inventory
    document.getElementById('category_items_1').value = categoryItems[1];
    document.getElementById('category_items_2').value = categoryItems[2];
    document.getElementById('category_items_3').value = categoryItems[3];
    document.getElementById('category_items_4').value = categoryItems[4];


    document.getElementById('patent').value = {{ character.patent }};
    document.getElementById('credit_limit').value = {{ character.credit_limit }};
}

generateDataObjects();
sortInventory();
sortRituals();

//-----------------------------
// Dice rolls
//-----------------------------

// Popup for dice rolls
function showDicePopup(text)
{
    const Toast = Swal.mixin({
        toast: true,
        position: "bottom-end",
        showConfirmButton: false,
        timer: 10000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.onmouseenter = Swal.stopTimer;
            toast.onmouseleave = Swal.resumeTimer;
        }
    });

    Toast.fire({
        text: text,
        showCloseButton: true,
    });
}

function rollAttribute(attribute)
{
    var attributeRolls = rollAttributeDice(attribute);

    var rollMsg = attribute.substring(10, 13).toUpperCase() + " [" + attributeRolls[0] + "] : " + attributeRolls;

    showDicePopup(rollMsg);
    sendMessage(1, rollMsg);
}

function rollAttributeDice(attribute)
{
    var attributeValue = document.getElementById(attribute).value;
    var rollsAmount = attributeValue != 0 ? attributeValue : 2;
    var rolls = new Array(rollsAmount);


    for (var i = 0; i < rollsAmount; i++)
        rolls[i] = Math.ceil(Math.random() * 20);
    
    rolls = rolls.sort((x, y) => { return x - y });

    if (attributeValue != 0)
        rolls = rolls.reverse();


    return rolls;
}

function rollSkill(skill)
{
    var attributes = ['attribute_agility', 'attribute_intellect', 'attribute_vigor', 'attribute_presence', 'attribute_strength'];
    var skillValues = [0, 5, 10, 15];
    

    var attribute = attributes[document.getElementById(skill + "_attribute").value];
    var skillTrainingValue = skillValues[document.getElementById(skill).value];
    var skillOthersValue = document.getElementById(skill + "_others").value;

    var rolls = rollAttributeDice(attribute);

    var totalRoll = parseInt(rolls[0]) + skillTrainingValue + parseInt(skillOthersValue);


    var rollMsg = skill[6].toUpperCase() + skill.substring(7).replace("_", ' ') + " [" + totalRoll + "] = " + rolls[0] + " + " + skillTrainingValue + " + " + skillOthersValue + " + (" + rolls + ")";


    showDicePopup(rollMsg);
    sendMessage(1, rollMsg);
}

//-----------------------------
// Character Sheet Update
//-----------------------------
function updateCharacter(url)
{
    //console.log("Updating character");
    document.getElementById('defense').innerHTML = 10 + parseInt($('#equipment_defense').val()) + parseInt($('#other_defense').val());

    $.ajax({
        type:'POST',
        url:'{% url 'update-character' character.id %}',
        data:
        {
            attribute_agility:$('#attribute_agility').val(),
            attribute_strength:$('#attribute_strength').val(),
            attribute_intellect:$('#attribute_intellect').val(),
            attribute_vigor:$('#attribute_vigor').val(),
            attribute_presence:$('#attribute_presence').val(),

            current_health:$('#current_health').val(),
            max_health:$('#max_health').val(),
            current_sanity:$('#current_sanity').val(),
            max_sanity:$('#max_sanity').val(),
            current_effort:$('#current_effort').val(),
            max_effort:$('#max_effort').val(),

            classe:$('#classe').val(),
            origin:$('#origin').val(),

            paranormal_exposition:$('#paranormal_exposition').val(),
            pe_turn:$('#pe_turn').val(),
            speed:$('#speed').val(),

            equipment_defense:$('#equipment_defense').val(),
            other_defense:$('#other_defense').val(),

            block:$('#block').val(),
            dodge:$('#dodge').val(),

            protection:$('#protection').val(),
            resistance:$('#resistance').val(),
            proficiency:$('#proficiency').val(),

            prestige:$('#prestige').val(),
            patent:$('#patent').val(),
            
            category_limit_1:$('#category_limit_1').val(),
            category_limit_2:$('#category_limit_2').val(),
            category_limit_3:$('#category_limit_3').val(),
            category_limit_4:$('#category_limit_4').val(),

            credit_limit:$('#credit_limit').val(),
            current_weight:$('#current_weight').val(),
            max_weight:$('#max_weight').val(),

            {% for skill in skills_count %} 
            
            {% call_method character 'get_skill_name' skills skill %}:$('#{% call_method character 'get_skill_name' skills skill %}').val() * 5,
            {% call_method character 'get_skill_name' skills skill %}_others:$('#{% call_method character 'get_skill_name' skills skill %}_others').val(),
            {% call_method character 'get_skill_name' skills skill %}_attribute:$('#{% call_method character 'get_skill_name' skills skill %}_attribute').val(),

            {% endfor %}

            notes:$('#notes').val(),
            appearance:$('#appearance').val(),
            personality:$('#personality').val(),
            background:$('#background').val(),
            objective:$('#objective').val(),
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function(data) 
        {
            console.log(data)
        }
    });
}

</script>

{% else %}

You dont have permission to visualize this character

{% endif %}

{% endblock content %}